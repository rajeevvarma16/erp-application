{% extends "base.html" %}
{% block title %}Employee Analytics{% endblock %}

{% block content %}
<h2 style="margin-bottom:20px;">Employee Analytics</h2>

<!-- KPI CARDS -->
<div style="display:flex; gap:20px; margin-bottom:20px;">
    <div style="flex:1;background:#fff;padding:20px;border-radius:10px;">
        <h3>Total Employees</h3>
        <h2>{{ total }}</h2>
    </div>
    <div style="flex:1;background:#fff;padding:20px;border-radius:10px;">
        <h3>Active</h3>
        <h2>{{ active }}</h2>
    </div>
    <div style="flex:1;background:#fff;padding:20px;border-radius:10px;">
        <h3>Inactive</h3>
        <h2>{{ inactive }}</h2>
    </div>
</div>

<!-- CHARTS -->
<div style="display:flex; gap:20px; margin-bottom:20px;">
    <div id="deptChart" style="flex:1;background:#fff;padding:20px;border-radius:10px;"></div>
    <div id="empMonthlyChart" style="flex:2;background:#fff;padding:20px;border-radius:10px;"></div>
</div>

<!-- LATEST EMPLOYEES -->
<div style="background:#fff;padding:20px;border-radius:10px;">
    <h3>Recent Employees</h3>
    <ul>
        {% for e in latest %}
        <li>{{ e.employee_name }} â€“ {{ e.department }}</li>
        {% endfor %}
    </ul>
</div>

<script>
// Injected data
var deptLabels = JSON.parse('{{ dept_labels | tojson | safe }}');
var deptCounts = JSON.parse('{{ dept_counts | tojson | safe }}');

var monthLabels = JSON.parse('{{ month_labels | tojson | safe }}');
var monthCounts = JSON.parse('{{ month_counts | tojson | safe }}');

// Department Bar Chart
new ApexCharts(document.querySelector("#deptChart"), {
    chart: { type: 'bar', height: 300 },
    series: [{ 
        name: 'Employees', 
        data: deptCounts 
    }],
    xaxis: { categories: deptLabels },
    colors: ['#00897B']
}).render();

// Monthly Hiring Line Chart
new ApexCharts(document.querySelector("#empMonthlyChart"), {
    chart: { type: 'line', height: 300 },
    series: [{
        name: 'New Employees',
        data: monthCounts
    }],
    xaxis: { categories: monthLabels },
    colors: ['#7E57C2']
}).render();
</script>

{% endblock %}
